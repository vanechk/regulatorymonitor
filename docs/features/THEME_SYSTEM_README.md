# Система Тем и Персонализации

## Обзор

Система тем в приложении TaxNewsRadar позволяет пользователям настраивать цветовую схему интерфейса в соответствии с их предпочтениями. Система автоматически синхронизирует настройки между локальным хранилищем и профилем пользователя.

## Архитектура

### 1. ThemeContext (`src/contexts/ThemeContext.tsx`)
Основной контекст для управления темами:
- Управляет светлой/темной темой
- Управляет основным цветом темы
- Автоматически обновляет CSS переменные
- Синхронизируется с профилем пользователя

### 2. AuthContext (`src/contexts/AuthContext.tsx`)
Хранит информацию о пользователе, включая:
- `themeColor` - цвет темы пользователя
- `themeMode` - режим темы (светлая/темная)

### 3. CSS Переменные
Система использует CSS переменные для динамического применения цветов:
```css
:root {
  --primary: hsl(220 85% 45%);
  --primary-light: hsl(220 85% 65%);
  --primary-dark: hsl(220 85% 25%);
  --accent: hsl(220 85% 45%);
  --ring: hsl(220 85% 45%);
  /* и другие... */
}
```

## Использование

### Настройка цвета темы

1. **Через ColorPicker в настройках:**
   - Перейдите в Настройки → Персонализация
   - Используйте ColorPicker для выбора цвета
   - Нажмите "Сохранить цвет темы"

2. **Быстрые тесты:**
   - В разделе "Быстрые тесты цветов" доступны предустановленные цвета
   - Нажмите на любой цвет для мгновенного применения

3. **Ручной ввод:**
   - Используйте поля HSL для точной настройки
   - Формат: `H S% L%` (например: `300 100% 50%` для розового)

### Применение цветов в компонентах

Используйте Tailwind классы, которые автоматически применяют цвета темы:

```tsx
// Основные цвета
<Button className="bg-primary text-primary-foreground">
  Кнопка
</Button>

// Hover эффекты
<Button className="hover:bg-primary-hover">
  Кнопка с hover
</Button>

// Границы
<div className="border-primary">
  Элемент с границей
</div>
```

## Отладка

### Проверка работы системы тем

1. **Откройте консоль браузера**
2. **Загрузите тестовый скрипт:**
   ```javascript
   // В консоли браузера
   window.testThemeSystem.runAllChecks()
   ```

3. **Проверьте CSS переменные:**
   ```javascript
   // В консоли браузера
   window.testThemeSystem.checkThemeVariables()
   ```

### Логи в консоли

ThemeContext выводит подробные логи:
- Обновление цвета темы
- Установка CSS переменных
- Обновление профиля пользователя

## Проблемы и решения

### Цвета не применяются

1. **Проверьте порядок провайдеров:**
   ```tsx
   <AuthProvider>
     <ThemeProvider>
       {/* приложение */}
     </ThemeProvider>
   </AuthProvider>
   ```

2. **Проверьте CSS переменные:**
   ```javascript
   document.documentElement.style.getPropertyValue('--primary')
   ```

3. **Проверьте localStorage:**
   ```javascript
   localStorage.getItem('themeColor')
   ```

### Синхронизация с профилем

1. **Проверьте авторизацию пользователя**
2. **Проверьте API endpoint `/api/auth/profile`**
3. **Проверьте структуру ответа сервера**

## Расширение

### Добавление новых цветов

1. **Добавьте CSS переменную в `theme.css`:**
   ```css
   :root {
     --new-color: hsl(220 85% 45%);
   }
   ```

2. **Обновите `tailwind.config.js`:**
   ```javascript
   colors: {
     'new-color': "hsl(var(--new-color))",
   }
   ```

3. **Обновите ThemeContext для динамического обновления**

### Добавление новых тем

1. **Создайте новый класс темы в CSS**
2. **Добавьте логику в ThemeContext**
3. **Обновите компонент переключения тем**

## Производительность

- CSS переменные обновляются только при изменении темы
- Профиль пользователя обновляется асинхронно
- Используется debouncing для предотвращения частых обновлений
- Стили применяются через CSS переменные для лучшей производительности
